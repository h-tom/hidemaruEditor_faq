<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="Shift_JIS">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>第II部〜知っていると便利な秀丸の機能　grep/タグジャンプ</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="base.css">
  <!--[if lt IE 9]>
    <script src="./html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>

<p><a href="hmindex0.html"><img src="hide_by2.png" alt="Hidemaru Q and A" width="88" height="32" /></a></p>
<h1 id="TOP">第II部〜知っていると便利な秀丸の機能　grep/タグジャンプ</h1>
<hr />
<h2 id="grep">●grep/タグジャンプ</h2>
<p>現在編集しているファイルの内容や、あるフォルダに置かれている複数のファイルから、 特定の文字列を含んだ行を全て調べる事ができます(<strong>grep(&quot;ぐれっぷ&quot;と読む(^^;)機能</strong>)。<br />
また、調べた結果の出力ファイルを使って、文字列の見つかった行(ファイル)へ直接移動する事ができます(<strong>タグジャンプ機能</strong>)。</p>
<ul>
<li><a href="#process">[手順]</a></li>
<li><a href="#SUPPLEMENTATION">[補足情報]</a>
<ul>
<li><a href="#SUPPLEMENTATION-1">タグジャンプ</a></li>
<li><a href="#SUPPLEMENTATION-2">grepのダイアログ</a></li>
<li><a href="#SUPPLEMENTATION-3">検索するフォルダ</a></li>
<li><a href="#SUPPLEMENTATION-4">検索するファイル</a></li>
<li><a href="#SUPPLEMENTATION-5">文字数制限の設定</a></li>
</ul></li>
</ul>
<div class="marginleft">
<h3 id="process">[手順]</h3>
<p>例えば、<strong>c:\diary</strong> フォルダにある、<strong>*.txt</strong> という拡張子を持つファイルから、「<strong>Love</strong>」という文字列を含む全ての行を調べたいとします。</p>
<ol style="list-style-type: decimal">
<li><p>メニューバーの「<strong>検索→grepの実行</strong>」を選択して下さい。</p>
<p><img src="2_grep_01.png" alt="grepダイアログ" width="461" height="338" /><br />
</p></li>
<li><p>一番上にある「<strong><span class="font_blue">検索する文字列</span></strong>」の部分に探したい文字列(今の例だと「<strong>Love</strong>」)を記入して下さい。</p></li>
<li><p>その下にある「<strong><span class="font_blue">検索するファイル</span></strong>」の部分に、検索対象となるファイル名を記入します(今の例だと「<strong>*.txt</strong>」)。<br />
※現在編集中の内容に対して実行したい時は、入力ボックスの右端にある矢印ボタンをクリックして&quot;<strong>(現在の内容)</strong>&quot;を選択して下さい。<br />
※ファイル名には<strong>MS-DOS</strong>のコマンドライン入力でお馴染み(?)の「<strong>ワイルドカード</strong>」が使用できます。 また、複数のファイル名を入力したい時は、ファイル名を<span class="monospace">&quot;;&quot;</span>(半角のセミコロン)で区切って下さい (<span class="monospace">ex.&quot;<strong>*.txt;file_?.man;a.doc</strong>&quot;</span>)。</p></li>
<li><p>その下にある「<strong>検索するフォルダ</strong>」で、検索対象のファイルのあるフォルダを選択します(今の例だと「<strong>c:\diary</strong>」)。 「...」ボタンを押すと、フォルダ参照ダイアログが開き、フォルダを選択可能です。</p></li>
<li>右側にあるチェックボックスの内、該当する物にチェックをします。
<ul>
<li><p><strong>「<span class="font_blue">大文字／小文字の区別</span>」チェックボックス：</strong><br />
検索文字列の大文字と小文字を区別して検索します。この項目がＯＦＦの場合、上の例で「<strong>LOVE</strong>」や「<strong>love</strong>」も検索されます。</p></li>
<li><p><strong>「<span class="font_blue">単語の検索</span>」チェックボックス：</strong><br />
この項目がＯＮになっていると、「<strong>Lover</strong>」や「<strong>ILoveNY</strong>」等の、ある単語の一部になっている場合は検索されません。 ここで言う「<strong>単語</strong>」とは、<strong>半角英字とアンダースコア(&quot;_&quot;)のみで構成された文字(列)</strong>を指します。</p></li>
<li><p><strong>「<span class="font_blue">正規表現</span>」チェックボックス：</strong><br />
検索文字列に「<strong>正規表現</strong>」が使える様になります。この項目をＯＮにすると、上記二つのオプション指定は無効になります。<br />
「<strong>正規表現</strong>」については「<a href="4_regular.html">●正規表現について</a>」を参照して下さい。</p></li>
<li><p><strong>「<span class="font_blue">あいまい検索</span>」チェックボックス：</strong><br />
「正規表現」をさらに便利にした「<strong>あいまい</strong>」な検索が可能になります(全半角同一視等…説明もあいまい(^^;)。</p></li>
<li><p><strong>「<span class="font_blue">追加の条件</span>」チェックボックス：</strong><br />
追加の条件に従って検索する範囲を制限できます。<br />
<a href="2_find.html">検索</a>の<a href="2_find.html#SUPPLEMENTATION-1">「追加の条件」について</a>を参照してください。</p></li>
<li><p><strong>「<span class="font_blue">検索文字列を強調</span>」チェックボックス</strong><br />
検索を実行後、検索に該当する文字列を強調表示します。</p></li>
<li><p><strong>「<span class="font_blue">ヒットしない行</span>」チェックボックス</strong><br />
これをONにすると、ヒットしない行を出力します。「追加の条件」が指定されている場合は、この設定は無効になります。</p></li>
<li><p><strong>「<span class="font_blue">サブフォルダも検索</span>」チェックボックス：</strong><br />
この項目がＯＮの時、指定されたフォルダにサブフォルダがある場合そのサブフォルダの中のファイルも検索します。</p></li>
<li><p><strong>「<span class="font_blue">最小化状態で実行</span>」チェックボックス：</strong><br />
grepの実行時は、実行結果を表示するための秀丸エディタウィンドウを自動で開きますが、この項目がＯＮの時はgrepの実行が終了するまで、 この結果表示ウィンドウをアイコン化します。</p></li>
<li><p><strong>「<span class="font_blue">ファイル名一覧だけ作成</span>」チェックボックス：</strong><br />
7. の出力結果の違いをご覧下さい。</p></li>
<li><p><strong>「<span class="font_blue">ファイル名をフルパスで出力</span>」チェックボックス：</strong><br />
この項目がＯＮの時、検索文字列が見つかったファイルのファイル名をフルパスで出力します。 ＯＦＦの場合はファイル名だけを出力します。</p></li>
<li><p><strong>「<span class="font_blue">エンコードの種類</span>」コンボボックス：</strong><br />
検索するファイルのエンコードを指定します。「自動判定」で不都合がある場合には、指定してみてください。 ただし、検索対象が全部同じエンコードでないと、誤判定します。</p></li>
<li><strong>「<span class="font_blue">出力先</span>」コンボボックス：</strong><br />
grep結果の出力先を指定します。
<ul>
<li>「自動」の場合は、新しいタブ、新しい秀丸エディタウィンドウを開きます。</li>
<li>「単一」は、grep結果を再利用します。なければ「自動と同じ」。</li>
<li>「タブグループごと」は、タブグループ内にgrep結果があれば再利用します。</li>
<li>「アウトプット枠」は、アウトプット枠を開き、そこに出力します。</li>
</ul></li>
</ul></li>
<li><p>右上の「ＯＫ」ボタンを押すと検索が始まります。</p></li>
<li><p>実行が終わると結果を表示するウィンドウができています。 その内容は「<strong>ファイル名一覧だけ作成</strong>」チェックボックスのＯＮ／ＯＦＦによって少し違います。</p>
<ul>
<li><p><strong>「ファイル名一覧だけ作成」が「ＯＦＦ」の時の動作</strong><br />
この項目がＯＦＦの時は、検索文字列が見つかった全てのファイル名と行を結果として書き出します。</p>
<p>[実行結果の例(&quot;file?.txt&quot;について&quot;２&quot;を検索)]<br />
file1.txt(2): ファイル１の２行目<br />
file1.txt(20): ファイル１の２０行目<br />
file2.txt(1): ファイル２の１行目<br />
file2.txt(2): ファイル２の２行目<br />
(以下略)</p></li>
<li><p><strong>「ファイル名一覧だけ作成」が「ＯＮ」の時の動作</strong><br />
この項目がＯＮの時は検索文字列が存在したファイル名(と始めに見つかった行番号)だけを結果として書き出します。 [実行結果の例(&quot;file?.txt&quot;について&quot;２&quot;を検索)]<br />
file1.txt(2)<br />
file2.txt(1)<br />
file3.txt(2)<br />
file4.txt(2)<br />
(以下略)</p></li>
</ul></li>
</ol>
<h3 id="SUPPLEMENTATION">[補足情報]</h3>
<p>grepに関係する動作環境です。</p>
<p><img src="2_grep_02.png" alt="動作環境−grepダイアログ" width="605" height="433" /><br />
</p>
<p><img src="2_grep_03.png" alt="動作環境−grepの動作" width="605" height="433" /><br />
</p>
<div class="marginleft">
<h4 id="SUPPLEMENTATION-1">タグジャンプ</h4>
<p>結果ウィンドウのファイル名の部分にカーソルがある状態で「<strong>その他→タグジャンプ</strong>」を選択すると、 (開かれていない時は開いてから)<strong>そのファイルの該当する行へ移動</strong>する事ができます。 また、「<strong>バックタグジャンプ</strong>」で元の結果ウィンドウに戻る事もできます。<br />
さらに、この結果ウィンドウをファイルとして保存する事もできて、上記の「<strong>タグジャンプ</strong>」も後から使用できます。 (ファイル名がフルパスでない場合は、ファイルを開いた箇所からの相対パスになるので、 「<strong>検索するフォルダ</strong>」に結果を保存する必要があります。)</p>
<p>設定により、結果ウィンドウのファイル名の部分をダブルクリックする事で、タグジャンプさせる事も可能です。 「動作環境−検索−grepの動作」にある、「grep結果」の「<strong>grep結果上ではダブルクリック=タグジャンプとする</strong>」に、 チェックを入れてください。</p>
<h4 id="SUPPLEMENTATION-2">grepのダイアログ</h4>
<p>grepダイアログの種類は2種類あります。</p>
<p><strong>新タイプ</strong>は、<a href="#process">[手順]</a>にあるダイアログで、<strong>普通タイプ</strong>は、フォルダ選択画面と一体になっています。</p>
<p><img src="2_grep_04.png" alt="動作環境−grepダイアログ普通タイプ" width="503" height="388" /><br />
</p>
<p><strong>新タイプ</strong>はフォルダ選択ダイアログが別になっている事もあり、種類も変更可能です。好みに応じて設定を変更してください。</p>
<!-- grepのダイアログ
</div>
 -->
<h4 id="SUPPLEMENTATION-3">検索するフォルダ</h4>
<p>通常、grep実行時に開いているファイルの場所を「検索するフォルダ」に自動的にセットしますが、 前回grep実行時のフォルダを最初からセットする事も可能です。</p>
<p>「動作環境 − 検索 − grepダイアログ − grepのダイアログボックス」にある、「<strong>前回のフォルダを使う</strong>」に、 チェックを入れてください。</p>
<p>「検索するフォルダ」は、「検索するファイル」と違い、複数箇所の指定は出来ません。</p>
<h4 id="SUPPLEMENTATION-4">検索するファイル</h4>
<p>「動作環境 − 検索 − grepダイアログ − grepの動作」で、検索するファイルの設定が可能です。</p>
<ul>
<li><p>「検索するファイル」の指定にマッチするファイルに対し、「除外」する方向の設定。</p>
<ul>
<li><p><span class="font_blue">隠しファイルを除外</span><br />
ファイル・フォルダの属性で、「隠しファイル」(HIDDEN)フラグが設定されいる場合は、 対象ファイル・フォルダでも除外します。</p></li>
<li><p><span class="font_blue">バイナリファイルと思わしきファイルを除外</span><br />
exeファイルなどテキストではないファイルを、除外します。</p>
<p>exeファイル等、あきらかに拡張子で判定可能なものは拡張子で判断し、それ以外はファイルを開いて判定します。</p></li>
<li><p><span class="font_blue">指定した拡張子を除外</span><br />
指定した拡張子を持つファイルを、対象外にします。</p>
<p>記述方法は2つあり、記述方法が異なるので注意。(混在は不可)</p>
<ul>
<li><p>拡張子を指定する記述方法<br />
<span class="monospace">&quot;.&quot;</span>(ドット)を含まない拡張子を指定します。実行ファイルの場合、 <span class="monospace">&quot;.exe&quot;</span> ではなく <span class="monospace">&quot;exe&quot;</span> と指定する。</p>
<p>複数の拡張子を指定する場合は &quot; &quot;(スペース)で区切る。<br />
実行ファイル(*.exe)とDLL(*.dll)を除外する場合：<span class="monospace"> exe dll</span></p></li>
<li><p>ワイルドカードを含む文字列を指定する記述方法<br />
&quot;*&quot;(アスタリクス)、&quot;?&quot;(クエスチョンマーク)を含む場合です。単独の場合はそのまま記述してください。&quot;*.exe&quot;等。</p>
<p>複数指定する場合は &quot;;&quot;(セミコロン)で区切る。<br />
実行ファイル(*.exe)とDLL(*.dll)を除外する場合：<span class="monospace"> *.exe;*.dll</span></p></li>
</ul></li>
</ul></li>
<li>「検索するファイル」でワイルドカード使用した場合の確認方法
<ul>
<li><p><span class="font_blue">拡張子と短縮ファイル名を厳密にチェックする。</span><br />
ワイルドカード使用時のファイル名チェックについての設定です。 チェックを入れておく事をお勧めします。</p>
<ul>
<li><p>説明</p>
<p>OSの歴史的な経緯が絡んでいます。<br />
MicrosoftのWindows以前のOSである「MS-DOS」は、ファイル名は英数字で8文字(8バイト)、 拡張子は3文字(3バイト)までしか扱えません。(8.3形式)<br />
Windowsが登場しファイル名の制限が緩和されましたが、MS-DOSとの互換性を考慮し、 MS-DOSのファイル名規則に当てはまらないファイルが作成された場合には、 OSが自動的にMS-DOS規格のファイル名も作成します。</p>
<div class="cmdprompt">
<pre><code>コマンドプロンプトから dir /x で 8.3形式 のファイル名を確認できる。
2016/05/19  19:09                34              file1.txt
2016/05/19  19:09                35              file2.txt
2016/05/19  19:09                35              file3.txt
2016/05/19  19:10                45 FILE3_~2.TXT file3_2longname.txt
2016/05/19  19:10                44 FILE3_~1.TXT file3_longname.txt
                                    ↑ OSが自動的に作成した名前
                                       ファイル名が8.3形式以外の場合作成される。</code></pre>
</div>
<p>上記のようなファイルがあり、チェックなしの状態で、検索するファイルに <strong>&quot;*1.txt&quot;</strong> を指定すると、</p>
<div class="macro">
<pre><code>file1.txt(1): 短縮名ファイルのテスト:file1.txt
file3_longname.txt(1): 短縮名ファイルのテスト：file3_longname.txt</code></pre>
</div>
<p>という結果になり、本来対象にならないはずの「file3_longname.txt」が対象になっています。 これは、OSが自動的に作成したMS-DOS規格のファイル名「FILE3_~1.TXT」が &quot;*1.txt&quot; にマッチするからです。</p>
<p>拡張子部分も同様で、4文字以上の拡張子を付けると、OSが自動的にMS-DOS規格のファイル名を作成します。</p>
<div class="cmdprompt">
<pre><code>2016/05/19  22:57                37 FILE1~1.HTM  file1.html
2016/05/19  22:58                35              file2.htm
                                    ↑ OSが自動的に作成した名前
                                       ファイル名が8.3形式以外の場合作成される。</code></pre>
</div>
<p>チェックなしの状態で、検索するファイルに <strong>&quot;*.htm&quot;</strong> を指定すると、</p>
<div class="macro">
<pre><code>file1.html(1): 短縮名ファイルのテスト：file1.html
file2.htm(1): 短縮名ファイルのテスト：file2.htm</code></pre>
</div>
<p>という結果になり、本来対象にならないはずの「file1.html」が対象になっています。 これは、OSが自動的に作成したMS-DOS規格のファイル名「FILE1~1.HTM」が &quot;*.htm&quot; にマッチするからです。</p>
<p>この動作はOSの仕様で、ワイルドカードを使用したファイル検索を行うと、元の名前だけでなく、8.3形式の名前に対してもチェックを行い、 どちらかにマッチした場合は、マッチしたと判定するためです。)</p>
<p>&quot;<span class="font_blue">拡張子と短縮ファイル名を厳密にチェックする。</span>&quot;にチェックを入れておくと、 上記のような事は起こらなくなります。</p></li>
</ul></li>
</ul></li>
</ul>
<h4 id="SUPPLEMENTATION-5">文字数制限の設定</h4>
<p><img src="2_grep_05.png" alt="動作環境−grepの動作−文字数制限の設定" width="455" height="344" /><br />
</p>
<p>処理の都合上、マッチした行が長いと全部を表示しない場合や、正規表現の対象となる一行の文字数の上限があります。 その制限に関する設定を行います。</p>
<p>通常使用しているファイルで、1行の文字数が多くなければ、&quot;<strong>小さい</strong>&quot;や&quot;<strong>大きい</strong>&quot;で問題ないでしょう。 どんなファイルでも必ずマッチさせたい場合は、&quot;<strong>制限なし</strong>&quot;を選択します。 (自身の使用環境により、適切と思われる設定を行ってください。)</p>
<ul>
<li>&quot;<span class="font_blue">制限を超えたとき確認メッセージを表示</span>&quot;にチェックを入れておくと、「制限なし」以外のとき、 制限にかかった場合は警告を表示します。</li>
</ul>
<!-- H3 -->
</div>
<!-- H2 -->
</div>
<hr />
<p><a href="hmindex0.html">目次に戻る</a></p>
</body>
</html>
