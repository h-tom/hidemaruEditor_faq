<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
  <meta charset="Shift_JIS" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>[HMM0075A] ●浮動小数点数版秀丸との互換性 - 秀丸エディタＱ＆Ａ集</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="base.css" />
  <!--[if lt IE 9]>
    <script src="./html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p><span class="link_navigate"><a href="HMM0074A.html">←前へ</a> <a href="HMM0076A.html">次へ→</a> <a href="qa_kinou.html">機能別Ｑ＆Ａ</a> <a href="qa_order.html">質問番号順Ｑ＆Ａ</a></span></p>
<hr />
<h1 id="hmm0075a">[HMM0075A]</h1>
<h2 id="HMM0075A_01">●浮動小数点数版秀丸との互換性</h2>
<div class="marginleft">
<dl>
<dt><img src="q.png" alt="Q." width="32" height="29" /></dt>
<dd><strong>浮動小数点数版(統合版)の秀丸エディタでマクロを実行すると、これまで通常の秀丸エディタで動作していたマクロの一部が誤動作するのですが、 互換性が無いのでしょうか？</strong>
</dd>
</dl>
<hr />
<dl>
<dt><img src="a.png" alt="A." width="32" height="29" /></dt>
<dd><p>浮動小数点数版(統合版)の秀丸エディタは、秀丸マクロの数値型変数に、浮動小数点数を格納できるようにしたものです。</p>
<p>マクロの文法は、数値 (リテラル) の書き方以外は100%互換がありますが、</p>
<ol type="1">
<li>浮動小数点数版のほうが扱える数値の範囲が広い（小数も使える、大きい/小さい値を使える）ので、 通常版の数値の仕様におさまらない場合があります。</li>
<li>通常版の秀丸エディタの仕様である、 <strong>数値型変数に整数しか入らないことを前提としたコーディングをしているマクロは、誤動作する可能性があります。</strong></li>
</ol>
<p>前者は比較的単純な話で、例えば、</p>
<div class="line-block">#i = 1.5 ;</div>
<p>というのは浮動小数点数版では正常なコーディングですが、通常版ではエラーになります。</p>
<p>また、通常版秀丸エディタでは、4 バイトの符号付き整数(-2147483648〜+2147483647)なので、 極端に大きい/小さい値を扱っている場合、浮動小数点版では問題ないが通常版では値がおかしくなります。</p>
<p>後者の例としては、/（除算）の演算結果を変数に格納すると、通常版秀丸エディタでは整数の商が入り、余りが切り捨てられます。 しかし、浮動小数点数版秀丸エディタでは、小数まで含んだ解が入ります。</p>
<p>その除算の結果をもとに条件判定すると、通常版と浮動小数点数版とで動作が異なる場合が出てきます。</p>
<p>以下の例は、#space個の半角スペースを$spaceに格納する例です。 単にループして半角スペースを１個ずつ足していくよりも、以下のようにしたほうが秀丸マクロでは実行速度が出ます。</p>
<p>以下のコーディングでは、通常版では正しく動作しますが、浮動小数点数版で動作させると、 whileループが意図したよりも１回多く回ることになります。</p>
<p>例えば #space == 10 の場合、#space / 80 == 0 であり、whileループの中のコードは実行されないというのが意図している動作です。 浮動小数点数版では、#space / 80 == 0.125 であるため、whileループの中のコードが１回実行されてしまいます。</p>
<div class="macro">
<pre><code>$space = &quot;&quot;;
#sp1 = #space / 80;
#sp2 = #space % 80;
while (#sp1 &gt; 0) {
    $space = $space + $space80;
    #sp1 = #sp1 - 1;
}
$space = $space + leftstr($space80, #sp2);</code></pre>
</div>
<p>通常版も浮動小数点数版も同様に動作させるための方法は、意図している動作とロジックの関係で、 必ずしも一概にはいえませんが、この例の場合、while文を</p>
<div class="macro">
<pre><code>while (#sp1 &gt;= 1) {</code></pre>
</div>
<p>と変更することで、通常版も浮動小数点数版でも同様に動作するようになります。</p>
<p>あるいは、常に整数の商を得るため、</p>
<div class="macro">
<pre><code>#sp1 = (#space - (#space % 80)) / 80;</code></pre>
</div>
<p>としてもよいでしょう。</p>
</dd>
</dl>
</div>
<hr />
<p><span class="link_navigate"><a href="HMM0074A.html">←前へ</a> <a href="HMM0076A.html">次へ→</a> <a href="qa_kinou.html">機能別Ｑ＆Ａ</a> <a href="qa_order.html">質問番号順Ｑ＆Ａ</a></span></p>
</body>
</html>
